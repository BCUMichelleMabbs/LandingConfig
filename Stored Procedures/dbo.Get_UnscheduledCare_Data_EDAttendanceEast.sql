SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO

CREATE PROCEDURE [dbo].[Get_UnscheduledCare_Data_EDAttendanceEast]
	
AS
BEGIN
	
	SET NOCOUNT ON;



--EXEC [RYPA4SRVSQL0014.CYMRU.NHS.UK].Wrexham_Live.dbo.BCU_Info_Attendances

	
DECLARE @LastAttendanceDate AS DATE = (SELECT ISNULL(MAX(ArrivalDate),'31 December 2009') FROM [Foundation].[dbo].[UnscheduledCare_Data_EDAttendance] WHERE Area='East' AND Source='Symphony')
DECLARE @LastAttendanceDateString AS VARCHAR(30) = DATENAME(DAY,@LastAttendanceDate) + ' ' + DATENAME(MONTH,@LastAttendanceDate) + ' ' + DATENAME(YEAR,@LastAttendanceDate)--+' 23:59:59.995'
DECLARE @DateToString AS VARCHAR(30) = DATENAME(DAY,GETDATE()) + ' ' + DATENAME(MONTH,GETDATE()) + ' ' + DATENAME(YEAR,GETDATE())
--DECLARE @DateToString AS VARCHAR(30) = '28 february 2021'
	SELECT  [Area]
      ,[Source]
      ,[AttendanceIdentifier]
      ,[LocalPatientIdentifier]
      ,[NHSNumber]
      ,[RegisteredGP]
      ,[RegisteredPractice]
      ,[PatientPostcode]
      ,[DHA]
      ,[ReferringGP]
      ,[ReferringPractice]
      ,[IncidentDate]
      ,[IncidentTime]
      ,[ArrivalDate]
      ,[ArrivalTime]
      ,[AmbulanceHandoverDate]
      ,[AmbulanceHandoverTime]
      ,[RegisteredDate]
      ,[RegisteredTime]
      ,[TriageStartDate]
      ,[TriageStartTime]
      ,[TriageEndDate]
      ,[TriageEndTime]
      ,[EDClinicianSeenDate]
      ,[EDClinicianSeenTime]
      ,[TreatmentStartDate]
      ,[TreatmentStartTime]
      ,[TreatmentCompleteDate]
      ,[TreatmentCompleteTime]
      ,[DecisionToAdmitDate]
      ,[DecisionToAdmitTime]
      ,[DischargeDate]
      ,[DischargeTime]
      ,[DepartureDate]
      ,[DepartureTime]
      ,[TransportRequestedDate]
      ,[TransportRequestedTime]
      ,[TransportArrivedDate]
      ,[TransportArrivedTime]
      ,[BedRequestedDate]
      ,[BedRequestedTime]
      ,[BedRequestedOutcomeDate]
      ,[BedRequestedOutcomeTime]
      ,[AmbulanceReference]
      ,[SiteCodeOfTreatment]
      ,[PresentingComplaint]
      ,[ReferralSource]
      ,[ArrivalMode]
      ,[PatientGroup]
      ,[AccompaniedBy1]
      ,[AccompaniedBy2]
      ,[IncidentLocation]
      ,[IncidentActivity]
      ,[TriageCategory]
      ,[TriageComplaint]
      ,[TriageTreatment]
      ,[TriageTreatment1]
      ,[TriageTreatment2]
      ,[TriageTreatment3]
      ,[TriageTreatment4]
      ,[TriageTreatment5]
      ,[TriageTreatment6]
      ,[TriageTreatment7]
      ,[TriageTreatment8]
      ,[TriageTreatment9]
      ,[TriageTreatment10]
      ,[TriageDiscriminator]
      ,[Immunisation]
      ,[School]
      ,[DischargeOutcome]
      ,[DischargeDestination]
      ,[AlcoholRelated]
      ,[TimeSinceIncident]
      ,[BedRequestedWard]
      ,[BedRequestedConsultant]
      ,[BedRequestedSpecialty]
      ,[BedRequestedOutcome]
      ,[EDClinicianSeen]
      ,[SeeAndTreat]
      ,[AttendanceCategory]
      ,[AppropriateAttendance]
      ,[RTAPatientType]
      ,[MechanismOfInjury]
      ,[Diagnosis1DiagnosisType]
      ,[Diagnosis1DiagnosisDate]
      ,[Diagnosis1DiagnosisTime]
      ,[Diagnosis1DiagnosisSite]
      ,[Diagnosis1DiagnosisSide]
      ,[Diagnosis2DiagnosisType]
      ,[Diagnosis2DiagnosisDate]
      ,[Diagnosis2DiagnosisTime]
      ,[Diagnosis2DiagnosisSite]
      ,[Diagnosis2DiagnosisSide]
      ,[Diagnosis3DiagnosisType]
      ,[Diagnosis3DiagnosisDate]
      ,[Diagnosis3DiagnosisTime]
      ,[Diagnosis3DiagnosisSite]
      ,[Diagnosis3DiagnosisSide]
      ,[Diagnosis4DiagnosisType]
      ,[Diagnosis4DiagnosisDate]
      ,[Diagnosis4DiagnosisTime]
      ,[Diagnosis4DiagnosisSite]
      ,[Diagnosis4DiagnosisSide]
      ,[Diagnosis5DiagnosisType]
      ,[Diagnosis5DiagnosisDate]
      ,[Diagnosis5DiagnosisTime]
      ,[Diagnosis5DiagnosisSite]
      ,[Diagnosis5DiagnosisSide]
      ,[Diagnosis6DiagnosisType]
      ,[Diagnosis6DiagnosisDate]
      ,[Diagnosis6DiagnosisTime]
      ,[Diagnosis6DiagnosisSite]
      ,[Diagnosis6DiagnosisSide]
      ,[Xray1RequestType]
      ,[XRay1RequestDate]
      ,[XRay1RequestTime]
      ,[Xray1RequestSite]
      ,[Xray1RequestSide]
      ,[Xray2RequestType]
      ,[XRay2RequestDate]
      ,[XRay2RequestTime]
      ,[Xray2RequestSite]
      ,[Xray2RequestSide]
      ,[Xray3RequestType]
      ,[XRay3RequestDate]
      ,[XRay3RequestTime]
      ,[Xray3RequestSite]
      ,[Xray3RequestSide]
      ,[Xray4RequestType]
      ,[XRay4RequestDate]
      ,[XRay4RequestTime]
      ,[Xray4RequestSite]
      ,[Xray4RequestSide]
      ,[Xray5RequestType]
      ,[XRay5RequestDate]
      ,[XRay5RequestTime]
      ,[Xray5RequestSite]
      ,[Xray5RequestSide]
      ,[Xray6RequestType]
      ,[XRay6RequestDate]
      ,[XRay6RequestTime]
      ,[Xray6RequestSite]
      ,[Xray6RequestSide]
      ,[Investigation1RequestType]
      ,[Investigation1RequestDate]
      ,[Investigation1RequestTime]
      ,[Investigation2RequestType]
      ,[Investigation2RequestDate]
      ,[Investigation2RequestTime]
      ,[Investigation3RequestType]
      ,[Investigation3RequestDate]
      ,[Investigation3RequestTime]
      ,[Investigation4RequestType]
      ,[Investigation4RequestDate]
      ,[Investigation4RequestTime]
      ,[Investigation5RequestType]
      ,[Investigation5RequestDate]
      ,[Investigation5RequestTime]
      ,[Investigation6RequestType]
      ,[Investigation6RequestDate]
      ,[Investigation6RequestTime]
      ,[Treatment1TreatmentType]
      ,[Treatment1TreatmentDate]
      ,[Treatment1TreatmentTime]
      ,[Treatment2TreatmentType]
      ,[Treatment2TreatmentDate]
      ,[Treatment2TreatmentTime]
      ,[Treatment3TreatmentType]
      ,[Treatment3TreatmentDate]
      ,[Treatment3TreatmentTime]
      ,[Treatment4TreatmentType]
      ,[Treatment4TreatmentDate]
      ,[Treatment4TreatmentTime]
      ,[Treatment5TreatmentType]
      ,[Treatment5TreatmentDate]
      ,[Treatment5TreatmentTime]
      ,[Treatment6TreatmentType]
      ,[Treatment6TreatmentDate]
      ,[Treatment6TreatmentTime]
      ,[SportsActivity]
      ,[LeftWithoutSeen]
      ,[CascardNumber]
      ,[PatientRefNo]
      ,[BREACHKEY1]
      ,[BREACHREASON1]
      ,[BREACHSTARTDATE1]
      ,[BREACHSTARTTIME1]
      ,[BREACHENDDATE1]
      ,[BREACHENDTIME1]
      ,[BREACHKEY2]
      ,[BREACHREASON2]
      ,[BREACHSTARTDATE2]
      ,[BREACHSTARTTIME2]
      ,[BREACHENDDATE2]
      ,[BREACHENDTIME2]
      ,[BREACHKEY3]
      ,[BREACHREASON3]
      ,[BREACHSTARTDATE3]
      ,[BREACHSTARTTIME3]
      ,[BREACHENDDATE3]
      ,[BREACHENDTIME3]
      ,[BREACHKEY4]
      ,[BREACHREASON4]
      ,[BREACHSTARTDATE4]
      ,[BREACHSTARTTIME4]
      ,[BREACHENDDATE4]
      ,[BREACHENDTIME4]
      ,[BREACHKEY5]
      ,[BREACHREASON5]
      ,[BREACHSTARTDATE5]
      ,[BREACHSTARTTIME5]
      ,[BREACHENDDATE5]
      ,[BREACHENDTIME5]
      ,[BREACHKEY6]
      ,[BREACHREASON6]
      ,[BREACHSTARTDATE6]
      ,[BREACHSTARTTIME]
      ,[BREACHENDDATE6]
      ,[BREACHENDTIME6]
      ,[ConsultationRequestDate1]
      ,[ConsultationRequestTime1]
      ,[ConsultationRequestCompletedDate1]
      ,[ConsultationRequestCompletedTime1]
      ,[ConsultationRequestSpecialty1]
      ,[ConsultationRequestDate2]
      ,[ConsultationRequestTime2]
      ,[ConsultationRequestCompletedDate2]
      ,[ConsultationRequestCompletedTime2]
      ,[ConsultationRequestSpecialty2]
      ,[ConsultationRequestDate3]
      ,[ConsultationRequestTime3]
      ,[ConsultationRequestCompletedDate3]
      ,[ConsultationRequestCompletedTime3]
      ,[ConsultationRequestSpecialty3]
      ,[ConsultationRequestDate4]
      ,[ConsultationRequestTime4]
      ,[ConsultationRequestCompletedDate4]
      ,[ConsultationRequestCompletedTime4]
      ,[ConsultationRequestSpecialty4]
      ,[ConsultationRequestDate5]
      ,[ConsultationRequestTime5]
      ,[ConsultationRequestCompletedDate5]
      ,[ConsultationRequestCompletedTime5]
      ,[ConsultationRequestSpecialty5]
      ,[ConsultationRequestDate6]
      ,[ConsultationRequestTime6]
      ,[ConsultationRequestCompletedDate6]
      ,[ConsultationRequestCompletedTime6]
      ,[ConsultationRequestSpecialty6]
      ,[AttendanceNumber]
  FROM [Foundation].[dbo].[UnscheduledCare_Data_SymphonyEast_OLD]
  WHERE 
	ArrivalDate> ''+@LastAttendanceDateString+'' AND ArrivalDate< ''+@DateToString+''


END
GO
